<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="tr">
<head>
<meta charset="utf-8">
<meta name="description" content="Multiprocessing ve socket modüllerini öğrenmek için bu yazıdaki örnekleri inceleyebilirsiniz. Basitçe anlattım.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Python ile soket programlama ve multiprocessing modülü | Python, Yazılım, ve Programlama</title>
<link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/html4css1.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../assets/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="http://ysar.net/python/soket-programlama-ve-multiprocessing.html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><meta name="author" content="Yaşar Arabacı">
<link rel="prev" href="excel-kutuphaneleri.html" title="Python ve Excel Kütüphaneleri" type="text/html">
<link rel="next" href="beautiful-soup-ve-basitce-kullanimi.html" title="Python Beautiful Soup Kütüphanesi ve Basitçe Kullanımı" type="text/html">
<meta property="og:site_name" content="Python, Yazılım, ve Programlama">
<meta property="og:title" content="Python ile soket programlama ve multiprocessing modülü">
<meta property="og:url" content="http://ysar.net/python/soket-programlama-ve-multiprocessing.html">
<meta property="og:description" content="Multiprocessing ve socket modüllerini öğrenmek için bu yazıdaki örnekleri inceleyebilirsiniz. Basitçe anlattım.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2011-10-17T19:42:00+03:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ana içeriğe geç</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://ysar.net/">

                <span id="blog-title">Python, Yazılım, ve Programlama</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" role="navigation" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../yasar-arabaci.html">Hakkımda</a>
                </li>
<li>
<a href="../soru-cevap.html">Soru-Cevap</a>
                </li>
<li>
<a href="../archive.html">Arşiv</a>
                </li>
<li>
<a href="../rss.xml">RSS kaynağı</a>

                
            </li>
</ul>
<!-- Custom search with google--><form id="search" action="//www.google.com/search" method="get" class="navbar-form pull-left">
<input type="hidden" name="q" value="site:http://ysar.net/"><input type="text" name="q" maxlength="255" results="0" placeholder="Search">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right">
<li>
    <a href="soket-programlama-ve-multiprocessing.md" id="sourcelink">Kaynak</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Python ile soket programlama ve multiprocessing modülü</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Yaşar Arabacı
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2011-10-17T19:42:00+03:00" itemprop="datePublished" title="2011-10-17 19:42">2011-10-17 19:42</time></a></p>
            
        <p class="sourceline"><a href="soket-programlama-ve-multiprocessing.md" class="sourcelink">Kaynak</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Bu yazıda, Python'daki multiprocessing ve socket modüllerini kullanarak
basit bir HTTP sunucusu yapacağız. Bu modülleri kullanmak isteyenler
ancak nereden başlayacağını bilemeyenler bu basit örnekle konuya giriş
yapabilirler.</p>
<p>Yaptığım şey özetle şu; 5 tane işlem port 9090'ı
dinliyor. Gelen isteklere sırasıyla cevap veriyorlar. Python içindeki
Threading modülünden farkı ne derseniz, Python'daki GIL (Global
Intrepreter Lock) yüzünden, threading modülü ile birden fazla işlemciyi
aynı anda kullanamıyorsunuz. Ancak multiprocessing ile birden fazla
işlem çalıştığı için, işlemcinizin tüm olanaklarından
yararlanabilirsiniz :) <!-- TEASER_END --></p>
<pre class="code literal-block"><span></span><span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="kn">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">log_to_stderr</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">socket</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">client</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"{u} connected"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">address</span><span class="p">))</span>
        <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"HTTP/1.1 200 OK</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"Content-Type: text/html</span><span class="se">\r\n\r\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">"OK"</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">num_workers</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="n">serversocket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">serversocket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">''</span><span class="p">,</span><span class="mi">9090</span><span class="p">))</span>
    <span class="n">serversocket</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">workers</span> <span class="o">=</span> <span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">serversocket</span><span class="p">,))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
            <span class="nb">range</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">workers</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">break</span>
</pre>


<h5>Ekleme:</h5>
<p>Ayrıca, Python'daki SocketServer modülün kullanarak şöyle birşeyler
yapmak da mümkün:</p>
<pre class="code literal-block"><span></span><span class="kn">import</span> <span class="nn">SocketServer</span>
<span class="k">class</span> <span class="nc">MyTCPHandler</span><span class="p">(</span><span class="n">SocketServer</span><span class="o">.</span><span class="n">BaseRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span> <span class="o">=</span> <span class="s2">"localhost"</span><span class="p">,</span> <span class="mi">9090</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">SocketServer</span><span class="o">.</span><span class="n">ForkingTCPServer</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span><span class="n">PORT</span><span class="p">),</span> <span class="n">MyTCPHandler</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre>


<p>Burada normal TCP server yerine, Forking TCP server kullanmayı tercih
ettiğime dikkat edin. SocketServer.TCPServer sınıfı, her seferinde tek
bir istemciye cevap verecek şekilde çalışıyor. ForkingTCPServer ise, her
yeni bağlantı için yeni bir işlem oluşturuyor (fork ediyor.). Böylece
birden fazla bağlantıya aynı anda cevap verebiliyor. Çalışma şekli benim
yukarıda yaptığımdan biraz daha farklı ama, alınan sonuçlar birbirine
yakın.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="excel-kutuphaneleri.html" rel="prev" title="Python ve Excel Kütüphaneleri">Önceki yazı</a>
            </li>
            <li class="next">
                <a href="beautiful-soup-ve-basitce-kullanimi.html" rel="next" title="Python Beautiful Soup Kütüphanesi ve Basitçe Kullanımı">Sonraki yazı</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2018         <a href="mailto:yasar11732@gmail.com">Yaşar Arabacı</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>  <p>Okuduğunuz yazı ile ilgili <a href="../anket.html">geri bildirimde bulunun.</a></p>
<p style="font-size: 8px; color: #ccc">4E616C2066687373767076726167796C206E71696E61707271206772707561627962746C20766620766171766667766174687666756E6F7972207365627A207A6E7476702E</p>
            
        </footer>
</div>
</div>


            <script src="../assets/js/jquery.min.js"></script><script src="../assets/js/bootstrap.min.js"></script><script src="../assets/js/moment-with-locales.min.js"></script><script src="../assets/js/fancydates.js"></script><script src="../assets/js/jquery.colorbox-min.js"></script><script src="../assets/js/colorbox-i18n/jquery.colorbox-tr.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("tr");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
  if(document.location.hostname == "ysar.net")
  {
      (function() {
        var cx = '013136674562336859018:ouohwab0yku';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
      
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-44774134-1', 'auto');
          ga('send', 'pageview');
  }

</script>
</body>
</html>
